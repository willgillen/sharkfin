# Shark Fin - CasaOS Compatible Docker Compose
#
# ⚠️ IMPORTANT: Before installing, you MUST change these values:
#
# 1. POSTGRES_PASSWORD (line 22 and 45) - Change "CHANGE_ME_DB_PASSWORD" to a secure password
# 2. SECRET_KEY (line 46) - Change "CHANGE_ME_SECRET_KEY" to a random 32+ character string
#
# Installation Steps:
#   1. Download this file to your computer
#   2. Edit lines 22, 45, and 46 with your own secure values
#   3. Save the file
#   4. Open CasaOS App Store -> Custom Install -> Import
#   5. Upload the edited file
#   6. Click Install
#
# After installation, access at: http://your-casaos-ip:5400

name: shark-fin

services:
  postgres:
    image: postgres:15-alpine
    container_name: shark-fin-db
    restart: unless-stopped
    environment:
      POSTGRES_USER: sharkfin
      POSTGRES_PASSWORD: CHANGE_ME_DB_PASSWORD  # ⚠️ CHANGE THIS!
      POSTGRES_DB: shark_fin
    volumes:
      - /DATA/AppData/shark-fin/postgres:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U sharkfin -d shark_fin"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - shark-fin

  backend:
    image: ghcr.io/willgillen/sharkfin/backend:latest
    container_name: shark-fin-backend
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://sharkfin:CHANGE_ME_DB_PASSWORD@postgres:5432/shark_fin  # ⚠️ CHANGE THIS! (must match postgres password above)
      SECRET_KEY: CHANGE_ME_SECRET_KEY  # ⚠️ CHANGE THIS! (use a random 32+ character string)
      ALGORITHM: HS256
      ACCESS_TOKEN_EXPIRE_MINUTES: 30
    # Backend port not exposed - accessed via frontend proxy only
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - shark-fin

  frontend:
    image: ghcr.io/willgillen/sharkfin/frontend:latest
    container_name: shark-fin-frontend
    restart: unless-stopped
    environment:
      BACKEND_URL: http://backend:5499
    ports:
      - "5400:5400"
    depends_on:
      - backend
    networks:
      - shark-fin

networks:
  shark-fin:
    driver: bridge

x-casaos:
  architectures:
    - amd64
    - arm64
  main: frontend
  author: Will Gillen
  category: Finance
  description:
    en_us: |
      Shark Fin is an open-source, self-hosted financial planning and budgeting
      application. Track your accounts, categorize transactions, create budgets,
      and gain insights into your spending patterns.

      Features:
      - Multi-account tracking (checking, savings, credit cards, investments)
      - Automatic transaction categorization with smart rules
      - Budget creation and monitoring with alerts
      - Financial reports and analytics (spending trends, income vs expenses)
      - CSV/OFX/QFX import support for bank statements
      - Payee management with merchant logo recognition
      - Cash flow forecasting
      - Net worth tracking

      Getting Started:
      1. Access the web UI at http://your-ip:5400
      2. Create your account
      3. Add your financial accounts
      4. Import transactions from your bank

      IMPORTANT: Before installing, change the POSTGRES_PASSWORD and SECRET_KEY
      environment variables to secure values!
  developer: Will Gillen
  icon: https://raw.githubusercontent.com/willgillen/sharkfin/main/frontend/public/sharkfin_logo.png
  tagline:
    en_us: Personal finance tracking and budgeting made simple
  title:
    en_us: Shark Fin
  index: /
  port_map: "5400"
